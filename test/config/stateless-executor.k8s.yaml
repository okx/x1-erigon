apiVersion: apps/v1
kind: Deployment
metadata:
  name: defi-xlayer-slexe
  namespace: forked-test2-xgon
  uid: 5a000f64-77fd-4591-9d36-2c3311d2bc7a
  resourceVersion: '618714547'
  generation: 1
  creationTimestamp: '2025-02-12T07:21:48Z'
  labels:
    app.okg.com/owner: efficiency-platform
  annotations:
    app.okg.com/app-category: UNKNOWN
    deployment.kubernetes.io/revision: '1'
  selfLink: /apis/apps/v1/namespaces/forked-test2-xgon/deployments/defi-xlayer-slexe
status:
  observedGeneration: 1
  replicas: 1
  updatedReplicas: 1
  unavailableReplicas: 1
  conditions:
    - type: Available
      status: 'False'
      lastUpdateTime: '2025-02-12T07:21:48Z'
      lastTransitionTime: '2025-02-12T07:21:48Z'
      reason: MinimumReplicasUnavailable
      message: Deployment does not have minimum availability.
    - type: Progressing
      status: 'True'
      lastUpdateTime: '2025-02-12T07:21:48Z'
      lastTransitionTime: '2025-02-12T07:21:48Z'
      reason: ReplicaSetUpdated
      message: ReplicaSet "defi-xlayer-slexe-699b7574c6" is progressing.
spec:
  replicas: 1
  selector:
    matchLabels:
      app.okcoin.com/name: defi-xlayer-slexe
  template:
    metadata:
      creationTimestamp: null
      labels:
        app.okcoin.com/name: defi-xlayer-slexe
    spec:
      volumes:
        - name: config
          persistentVolumeClaim:
            claimName: dev-xlayer
        - name: shared-memory
          emptyDir:
            medium: Memory
            sizeLimit: 8Gi
        - name: java-gc
          persistentVolumeClaim:
            claimName: java-gc
        - name: tools
          persistentVolumeClaim:
            claimName: tools
        - name: prestop
          persistentVolumeClaim:
            claimName: prestop
        - name: shared-tools
          emptyDir: {}
      containers:
        - name: defi-xlayer-slexe
          image: >-
            office-registry-vpc.cn-hongkong.cr.aliyuncs.com/defi/okchain-x1-prover:backdoor-v9.0.0-rc3-0ab75c28-20250124183509
          command:
            - /bin/sh
            - '-c'
            - zkProver -c /config/erigon/stateless_executor.json
          ports:
            - name: executor
              containerPort: 50071
              protocol: TCP
          envFrom:
            - configMapRef:
                name: apollo-config
            - configMapRef:
                name: nacos-config
          env:
            - name: MY_APPLICATION_NAME
              value: defi-xlayer-slexe
            - name: MY_POD_NAMESPACE
              valueFrom:
                fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.namespace
            - name: MY_POD_NAME
              valueFrom:
                fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.name
            - name: MY_NODE_NAME
              valueFrom:
                fieldRef:
                  apiVersion: v1
                  fieldPath: spec.nodeName
            - name: MY_POD_IP
              valueFrom:
                fieldRef:
                  apiVersion: v1
                  fieldPath: status.podIP
            - name: APOLLO_CLUSTER
              value: ${MY_POD_NAMESPACE}
            - name: OKTS_LANE_ENABLE
              value: 'true'
            - name: OKTS_LANE_ID
              value: $(MY_POD_NAMESPACE)
            - name: OKTS_POD_NAME
              value: $(MY_POD_NAME)
            - name: OKTS_APP_NAME
              value: $(MY_APPLICATION_NAME)
            - name: MONITOR_OPTIONS
              value: >-
                -javaagent:/app/skywalking/agent/skywalking-agent.jar
                -Dskywalking.agent.service_name=$(MY_APPLICATION_NAME)
                -Dskywalking.agent.instance_name=$(MY_POD_IP)
                -Dskywalking.agent.namespace=$(MY_POD_NAMESPACE)
                -Dskywalking.collector.backend_service=test-apmswapi.okg.com:10000
                -Dskywalking.collector.backend_http_service=test-apmswapi.okg.com:12800
            - name: DEBUG_OPTIONS
              value: '-agentlib:jdwp=transport=dt_socket,address=*:,server=y,suspend=n'
            - name: JAVA_OPTIONS
              value: '@{javaOptions}  $(MONITOR_OPTIONS)'
            - name: JDK17_OPTIONS
              value: '@{javaOptions}  $(MONITOR_OPTIONS)'
            - name: aliyun_logs_forked-test2-xgon--defi-xlayer-slexe
              value: plugin
            - name: aliyun_logs_forked-test2-xgon--defi-xlayer-slexe_ttl
              value: '1'
            - name: aliyun_logs_forked-test2-xgon--defi-xlayer-slexe_detail
              value: >-
                {"plugin":{"inputs":[{"type":"service_docker_stdout","detail":{"Stdout":true,"Stderr":true,"IncludeEnv":{"aliyun_logs_forked-test2-xgon--defi-xlayer-slexe":"plugin"},"BeginLineRegex":"\\d+-\\d+-\\d+.*"}}],"global":{"AlwaysOnline":true}}}
          resources:
            limits:
              cpu: '2'
              memory: 4Gi
            requests:
              cpu: '1'
              memory: 2Gi
          volumeMounts:
            - name: config
              mountPath: /config
            - name: shared-memory
              mountPath: /dev/shm
            - name: prestop
              mountPath: /prestop
            - name: java-gc
              mountPath: /app/gc
              subPathExpr: >-
                office-test2-cluster/$(MY_POD_NAMESPACE)/defi-xlayer-slexe/$(MY_POD_NAME)/gc
            - name: tools
              mountPath: /tools
            - name: java-gc
              mountPath: /app/dumps
              subPathExpr: >-
                office-test2-cluster/$(MY_POD_NAMESPACE)/defi-xlayer-slexe/$(MY_POD_NAME)/dumps
            - name: shared-tools
              mountPath: /app/skywalking
          lifecycle:
            preStop:
              exec:
                command:
                  - sh
                  - '-c'
                  - /prestop/prestop.sh
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          imagePullPolicy: Always
      restartPolicy: Always
      terminationGracePeriodSeconds: 30
      dnsPolicy: ClusterFirst
      securityContext: {}
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
              - matchExpressions:
                  - key: app
                    operator: In
                    values:
                      - 'true'
      schedulerName: default-scheduler
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 0
      maxSurge: 1
  revisionHistoryLimit: 10
  progressDeadlineSeconds: 300
