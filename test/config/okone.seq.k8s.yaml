apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    PIPELINE_RUN_IMAGE: office-registry-vpc.cn-hongkong.cr.aliyuncs.com/office-okcoin/cdk-erigon_none:zjg_dev-cb522900-20250102155008
    app.okg.com/app-category: UNKNOWN
    app.okg.com/env-type: FORKED
    app.okg.com/lane-from-ns: base-global
    com.okcoin.devops/audit.action: get
    com.okcoin.devops/audit.time: 2025-02-13 18:36:54 GMT+8
    com.okcoin.devops/audit.user: '["chao.huang@okg.com"]'
    deployment.kubernetes.io/revision: "6"
    project.branch: zjg/dev
    project.commitid: cb5229007806e4d582181818ff6ea359c4195929
    project.language: go
    project.module: NONE
    project.url: git@gitlab.okg.com:okchain/cdk-erigon.git
  creationTimestamp: "2025-02-18T06:43:18Z"
  generation: 6
  labels:
    app.okg.com/owner: efficiency-platform
    k8slens-edit-resource-version: v1
  name: erigon-seq
  namespace: forked-test2-xgon
  resourceVersion: "631311864"
  uid: cb477e62-c787-45cf-8700-78f402d6b22a
spec:
  progressDeadlineSeconds: 300
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app.okcoin.com/name: erigon-seq
  strategy:
    type: Recreate
  template:
    metadata:
      annotations:
        kubectl.kubernetes.io/restartedAt: "2025-02-18T07:00:46Z"
        prometheus.io/path: /debug/metrics/prometheus
        prometheus.io/port: "7001"
        prometheus.io/scrape: "true"
      creationTimestamp: null
      labels:
        app.okcoin.com/name: erigon-seq
        lane/app.id: "62582"
        lane/csg.id: "101207"
        lane/env.id: "37883"
        lane/service.id: "272801"
    spec:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: app
                operator: In
                values:
                - "true"
      containers:
      - command:
        - /bin/sh
        - -c
        - cdk-erigon --http.vhosts=* --http.corsdomain=* --ws --config=/data/mainnet/xlayerconfig-mainnet.yaml
        env:
        - name: CDK_ERIGON_SEQUENCER
          value: "1"
        - name: MY_APPLICATION_NAME
          value: erigon-seq
        - name: MY_POD_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: MY_POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: MY_NODE_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: spec.nodeName
        - name: MY_POD_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.podIP
        - name: APOLLO_CLUSTER
          value: ${MY_POD_NAMESPACE}
        - name: OKTS_LANE_ENABLE
          value: "true"
        - name: OKTS_LANE_ID
          value: $(MY_POD_NAMESPACE)
        - name: OKTS_POD_NAME
          value: $(MY_POD_NAME)
        - name: OKTS_APP_NAME
          value: $(MY_APPLICATION_NAME)
        envFrom:
        - configMapRef:
            name: apollo-config
        - configMapRef:
            name: nacos-config
        image: office-registry-vpc.cn-hongkong.cr.aliyuncs.com/defi/okchain-cdk-erigon:dev-0d694633-20250218145211
        imagePullPolicy: Always
        livenessProbe:
          failureThreshold: 20
          initialDelaySeconds: 30
          periodSeconds: 30
          successThreshold: 1
          tcpSocket:
            port: 8545
          timeoutSeconds: 10
        name: erigon-seq
        ports:
        - containerPort: 7001
          name: 7001tcp
          protocol: TCP
        - containerPort: 6060
          name: 6060tcp
          protocol: TCP
        - containerPort: 8545
          name: 8545tcp
          protocol: TCP
        - containerPort: 6900
          name: 6900tcp
          protocol: TCP
        readinessProbe:
          failureThreshold: 20
          initialDelaySeconds: 30
          periodSeconds: 30
          successThreshold: 1
          tcpSocket:
            port: 8545
          timeoutSeconds: 10
        resources:
          limits:
            cpu: "8"
            memory: 32Gi
          requests:
            cpu: "4"
            memory: 16Gi
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /data
          name: data
        - mountPath: /config
          name: config
        - mountPath: /dev/shm
          name: shared-memory
        - mountPath: /app/gc
          name: java-gc
          subPathExpr: office-test2-cluster/$(MY_POD_NAMESPACE)/erigon-seq/$(MY_POD_NAME)/gc
        - mountPath: /app/dumps
          name: java-gc
          subPathExpr: office-test2-cluster/$(MY_POD_NAMESPACE)/erigon-seq/$(MY_POD_NAME)/dumps
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext:
        fsGroup: 2000
      terminationGracePeriodSeconds: 30
      volumes:
      - name: data
        persistentVolumeClaim:
          claimName: defi-xlayer-egseq-pvc
      - name: config
        persistentVolumeClaim:
          claimName: dev-xlayer
      - emptyDir:
          medium: Memory
          sizeLimit: 8Gi
        name: shared-memory
      - name: java-gc
        persistentVolumeClaim:
          claimName: java-gc
status:
  availableReplicas: 1
  conditions:
  - lastTransitionTime: "2025-02-18T07:12:23Z"
    lastUpdateTime: "2025-02-18T07:12:23Z"
    message: Deployment has minimum availability.
    reason: MinimumReplicasAvailable
    status: "True"
    type: Available
  - lastTransitionTime: "2025-02-18T07:00:13Z"
    lastUpdateTime: "2025-02-18T07:12:23Z"
    message: ReplicaSet "erigon-seq-68c5fdb55" has successfully progressed.
    reason: NewReplicaSetAvailable
    status: "True"
    type: Progressing
  observedGeneration: 6
  readyReplicas: 1
  replicas: 1
  updatedReplicas: 1
